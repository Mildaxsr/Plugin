<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: extension.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: extension.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Подключение API VS Code
const vscode = require('vscode');

/**
 * Добавляет символ "# " перед каждой строкой.
 * Пустая строка превращается в строку, содержащую только "#".
 *
 * Уже закомментированные строки (начинающиеся с "#", игнорируя отступы)
 * остаются без изменений.
 *
 * @param {string[]} lines - Массив строк выделенного текста.
 * @returns {string[]} Новый массив строк с добавленными комментариями.
 */
function addComments(lines) {
    const newLines = [];
    for (const line of lines) {
        // Пустая строка → просто "#"
        if (line.trim() === '') {
            newLines.push('#');
            continue;
        }

        // Если строка уже закомментирована (игнорируем ведущие пробелы)
        if (line.replace(/^\s+/, '').startsWith('#')) {
            newLines.push(line);
        } else {
            newLines.push(`# ${line}`);
        }
    }
    return newLines;
}

/**
 * Удаляет символ "#" (и пробел после него, если есть) в начале строки.
 * Сохраняет исходные отступы (ведущие пробелы).
 *
 * @param {string[]} lines - Массив строк выделенного текста.
 * @returns {string[]} Новый массив строк без начального "#".
 */
function removeComments(lines) {
    const newLines = [];
    for (const line of lines) {
        // Пустая строка → возвращаем как есть
        if (line.trim() === '') {
            newLines.push(line);
            continue;
        }

        const leadingSpacesMatch = line.match(/^\s*/);
        const leadingSpaces = leadingSpacesMatch ? leadingSpacesMatch[0] : '';
        const stripped = line.slice(leadingSpaces.length);

        if (stripped.startsWith('#')) {
            let withoutHash = stripped.slice(1);
            if (withoutHash.startsWith(' ')) {
                withoutHash = withoutHash.slice(1);
            }
            newLines.push(leadingSpaces + withoutHash);
        } else {
            newLines.push(line);
        }
    }
    return newLines;
}

/**
 * Форматирует комментарии так, чтобы длина строки не превышала заданную ширину.
 *
 * Обрабатываются только строки, начинающиеся с "#". Отступы в начале строки
 * сохраняются. Текст комментария переносится по словам (word wrap).
 *
 * @param {string[]} lines - Массив строк выделенного текста.
 * @param {number} [width=80] - Максимальная ширина строки.
 * @returns {string[]} Новый массив строк с отформатированными комментариями.
 */
function formatComments(lines, width = 80) {
    const newLines = [];
    for (const line of lines) {
        const leadingSpacesMatch = line.match(/^\s*/);
        const leadingSpaces = leadingSpacesMatch ? leadingSpacesMatch[0] : '';
        const stripped = line.slice(leadingSpaces.length);

        // Если строка не начинается с "#", оставляем без изменений
        if (!stripped.startsWith('#')) {
            newLines.push(line);
            continue;
        }

        // Убираем "# " в начале и работаем только с содержимым
        let content = stripped.slice(1);
        if (content.startsWith(' ')) {
            content = content.slice(1);
        }

        const effectiveWidth = width - leadingSpaces.length - 2; // отступ + "# "
        if (effectiveWidth &lt;= 0) {
            newLines.push(line);
            continue;
        }

        const wrappedLines = wrapText(content, effectiveWidth);
        for (const wline of wrappedLines) {
            newLines.push(leadingSpaces + '# ' + wline);
        }
    }
    return newLines;
}

/**
 * Переносит текст по словам так, чтобы строка не превышала maxWidth символов.
 *
 * @param {string} text - Исходный текст.
 * @param {number} maxWidth - Максимальная длина строки.
 * @returns {string[]} Массив строк, полученных после переноса.
 */
function wrapText(text, maxWidth) {
    const words = text.split(/\s+/).filter(w => w.length > 0);
    const result = [];
    let currentLine = '';

    for (const word of words) {
        if (currentLine.length === 0) {
            currentLine = word;
        } else if (currentLine.length + 1 + word.length &lt;= maxWidth) {
            currentLine += ' ' + word;
        } else {
            result.push(currentLine);
            currentLine = word;
        }
    }

    if (currentLine.length > 0) {
        result.push(currentLine);
    }

    return result;
}

/**
 * Универсальная обёртка: превращает многострочный текст в массив строк,
 * применяет указанную функцию-преобразователь и собирает результат обратно.
 *
 * @param {string} text - Исходный многострочный текст.
 * @param {(lines: string[]) => string[]} processor - Функция, обрабатывающая массив строк.
 * @returns {string} Новый многострочный текст.
 */
function processText(text, processor) {
    const lines = text.split(/\r?\n/);
    const newLines = processor(lines);
    return newLines.join('\n');
}

/**
 * Применяет обработчик ко всем выделениям в редакторе.
 *
 * Для каждого непустого выделения:
 *  - берётся выделенный текст,
 *  - преобразуется функцией processor,
 *  - результат подставляется на место выделения.
 *
 * @param {vscode.TextEditor} editor - Текущий текстовый редактор VS Code.
 * @param {vscode.TextEditorEdit} edit - Объект для внесения изменений.
 * @param {(text: string) => string} processor - Функция обработки текста.
 */
function applyToSelections(editor, edit, processor) {
    const document = editor.document;

    editor.selections.forEach(selection => {
        if (selection.isEmpty) {
            return;
        }
        const selectedText = document.getText(selection);
        const newText = processor(selectedText);
        edit.replace(selection, newText);
    });
}

/**
 * Функция активации расширения.
 *
 * Вызывается VS Code при первом запуске любой из команд расширения.
 * Здесь регистрируются три команды:
 *  - commentFormatter.addComments
 *  - commentFormatter.removeComments
 *  - commentFormatter.formatComments
 *
 * @param {vscode.ExtensionContext} context - Контекст расширения VS Code.
 */
function activate(context) {
    console.log('Comment Formatter extension activated');

    const addCmd = vscode.commands.registerTextEditorCommand(
        'commentFormatter.addComments',
        (editor, edit) => {
            vscode.window.showInformationMessage('Add comments command executed');
            applyToSelections(editor, edit, text => processText(text, addComments));
        }
    );

    const removeCmd = vscode.commands.registerTextEditorCommand(
        'commentFormatter.removeComments',
        (editor, edit) => {
            vscode.window.showInformationMessage('Remove comments command executed');
            applyToSelections(editor, edit, text => processText(text, removeComments));
        }
    );

    const formatCmd = vscode.commands.registerTextEditorCommand(
        'commentFormatter.formatComments',
        (editor, edit) => {
            vscode.window.showInformationMessage('Format comments command executed');
            applyToSelections(editor, edit, text =>
                processText(text, lines => formatComments(lines, 80))
            );
        }
    );

    context.subscriptions.push(addCmd, removeCmd, formatCmd);
}

/**
 * Функция деактивации расширения.
 * В данном плагине дополнительная очистка не требуется.
 */
function deactivate() {}

module.exports = {
    activate,
    deactivate
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#activate">activate</a></li><li><a href="global.html#addComments">addComments</a></li><li><a href="global.html#applyToSelections">applyToSelections</a></li><li><a href="global.html#deactivate">deactivate</a></li><li><a href="global.html#formatComments">formatComments</a></li><li><a href="global.html#processText">processText</a></li><li><a href="global.html#removeComments">removeComments</a></li><li><a href="global.html#wrapText">wrapText</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Sun Nov 16 2025 14:40:22 GMT+0300 (Москва, стандартное время)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
